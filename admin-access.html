<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Access Required</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
    <h1>Admin Access Required</h1>
    <p>You must be logged in to view the admin area. Redirecting to login...</p>
    
    <script>
        if (window.netlifyIdentity) {
            // Initialize the widget
            window.netlifyIdentity.init();

            // When a user logs in, redirect them to the admin dashboard
            window.netlifyIdentity.on('login', user => {
                window.location.href = '/admin/';
            });

            // When a login error occurs, display it to the user
            window.netlifyIdentity.on('error', (err) => {
                console.error('Login Error:', err);
                const p = document.querySelector('p');
                p.textContent = `Login failed: ${err.message}. Redirecting to the homepage...`;
                p.style.color = 'red';
                setTimeout(() => {
                    window.location.href = '/';
                }, 3000); // Wait 3 seconds before redirecting
            });

            // When the login modal is closed, we check if the user is logged in.
            // If they are not, we redirect them to the home page so they
            // aren't stuck on this access page.
            window.netlifyIdentity.on('close', () => {
                const user = window.netlifyIdentity.currentUser();
                if (!user) {
                    window.location.href = '/';
                }
            });

            // Automatically open the login modal
            window.netlifyIdentity.open('login');
        }
    </script>
</body>
</html>